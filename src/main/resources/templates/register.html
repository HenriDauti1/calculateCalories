<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="/static/css/register.css">
</head>
<body>
<div class="register-container">
    <h2>Register Here</h2>
    <form id="registerForm" method="POST">
        <div class="form-row">
            <div class="form-group">
                <label for="first-name">First Name:</label>
                <input type="text" id="first-name" name="first-name" placeholder="Enter your first name" >
                <span class="error" id="first-name-error"></span>
            </div>
            <div class="form-group">
                <label for="last-name">Last Name:</label>
                <input type="text" id="last-name" name="last-name" placeholder="Enter your last name" >
                <span class="error" id="last-name-error"></span>
            </div>
        </div>
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" placeholder="Enter your username" >
            <span class="error" id="username-error"></span>
        </div>

        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" placeholder="Enter your email" >
            <span class="error" id="email-error"></span>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" placeholder="Enter your password" >
            <span class="error" id="password-error"></span>
        </div>
        <div class="form-group">
            <label for="confirm-password">Confirm Password:</label>
            <input type="password" id="confirm-password" name="confirm-password" placeholder="Confirm your password" >
            <span class="error" id="confirm-password-error"></span>
        </div>
        <div class="button-container">
            <button type="submit">Register</button>
        </div>
    </form>
    <div class="login-link">
        <p>Already have an account? <a href="./login.html">Log in here</a></p>
    </div>
</div>
<script>
    const registerForm = document.getElementById('registerForm');

    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const firstNameRegex = /^[a-z ,.'-]+$/i;
        const lastNameRegex = /^[a-z ,.'-]+$/i;
        const usernameRegex = /^[a-zA-Z0-9_]{3,}$/;
        const emailRegex = /^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+$/;
        const passwordRegex = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@$!%*?&.])[A-Za-z\d@$!%*?&]{6,}$/;

        const firstName = document.getElementById('first-name').value.trim();
        const lastName = document.getElementById('last-name').value.trim();
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();
        const confirmPassword = document.getElementById('confirm-password').value.trim();

        const firstNameError = document.getElementById('first-name-error');
        const lastNameError = document.getElementById('last-name-error');
        const usernameError = document.getElementById('username-error');
        const emailError = document.getElementById('email-error');
        const passwordError = document.getElementById('password-error');
        const confirmPasswordError = document.getElementById('confirm-password-error');

        firstNameError.style.display = 'none';
        lastNameError.style.display = 'none';
        usernameError.style.display = 'none';
        emailError.style.display = 'none';
        passwordError.style.display = 'none';
        confirmPasswordError.style.display = 'none';

        let isValid = true;

        if (!firstName) {
            firstNameError.textContent = 'First name is required.';
            firstNameError.style.display = 'block';
            isValid = false;
        } else if (!firstNameRegex.test(firstName)) {
            firstNameError.textContent = 'First name is invalid.';
            firstNameError.style.display = 'block';
            isValid = false;
        }

        if (!lastName) {
            lastNameError.textContent = 'Last name is required.';
            lastNameError.style.display = 'block';
            isValid = false;
        } else if (!lastNameRegex.test(lastName)) {
            lastNameError.textContent = 'Last name is invalid.';
            lastNameError.style.display = 'block';
            isValid = false;
        }

        if (!username) {
            usernameError.textContent = 'Username is required.';
            usernameError.style.display = 'block';
            isValid = false;
        } else if (!usernameRegex.test(username)) {
            usernameError.textContent = 'Username is invalid.';
            usernameError.style.display = 'block';
            isValid = false;
        }

        if (!email) {
            emailError.textContent = 'Email is required.';
            emailError.style.display = 'block';
            isValid = false;
        } else if (!emailRegex.test(email)) {
            emailError.textContent = 'Email is invalid.';
            emailError.style.display = 'block';
            isValid = false;
        }

        if (!password) {
            passwordError.textContent = 'Password is required.';
            passwordError.style.display = 'block';
            isValid = false;
        } else if (!passwordRegex.test(password)) {
            passwordError.textContent = 'Password is invalid.';
            passwordError.style.display = 'block';
            isValid = false;
        }

        if (!confirmPassword) {
            confirmPasswordError.textContent = 'Confirm password is required.';
            confirmPasswordError.style.display = 'block';
            isValid = false;
        } else if (password !== confirmPassword) {
            confirmPasswordError.textContent = 'Passwords do not match.';
            confirmPasswordError.style.display = 'block';
            isValid = false;
        }

        if (!isValid) {
            return;
        }

        try {
            const response = await fetch('http://localhost:8080/api/users/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + btoa("Admin" + ':' + "Test123!")
                },
                body: JSON.stringify({ firstName, lastName, username, email, password, confirmPassword }),
            });

            if (response.ok) {
                alert('Registration successful!');
                window.location.href = "./login.html";
            } else {
                const result = await response.json();
                alert(result.message || 'Registration failed.');
            }
        } catch (error) {
            alert('An unexpected error occurred.');
        }
    });
</script>
</body>
</html>